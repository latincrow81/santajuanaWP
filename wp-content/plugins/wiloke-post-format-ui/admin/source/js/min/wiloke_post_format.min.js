!function(e){"use strict";function t(){e("#formatdiv").css("display","none"),e(".wiloke-post-format-wrapper .wiloke-controls-post-format").on("click","a",function(){var t=e(this),a=t.closest(".wiloke-post-format-wrapper"),i=t.parent("li"),o=(t.data("format"),t.attr("href"));return e(o).hasClass("active")||(a.find(".active").removeClass("active"),i.addClass("active"),e("#wiloke-"+o).addClass("active"),e("#"+o).prop("checked",!0)),!1})}function a(){e(".wiloke-button-media").on("click",".add",function(t){t.preventDefault();var a,i,o=e(this),l=o.closest(".wiloke-format-block"),n=e(".screenshot",l),r=e(".wiloke-media-value",l),s=r.val(),c=e(this).data("type");if("image"==c){if(a)return a.open(),void 0;a=wp.media({multiple:!1,title:o.data("choose"),button:{text:o.data("update")}}),a.on("open",function(){var e=a.state().get("selection");if(s){var t=wp.media.attachment(s);e.add(t?[t]:[]),console.log(e)}}),a.on("select",function(){var e=a.state().get("selection"),t="";e.each(function(e){var a=e.attributes,i="undefined"!=typeof a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;t='<li><img src="'+i+'"></li>',r.val(a.id),n.html(t)})}),a.open()}else{if("undefined"==typeof wp||!wp.media||!wp.media.gallery)return;i=s?'[gallery ids="'+s+'"]':'[gallery ids="0"]';var a=wp.media.gallery.edit(i);a.state("gallery-edit").on("update",function(e){n.html("");var t,a="",i=e.models.map(function(e){t=e.toJSON();var i="undefined"!=typeof t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;return a='<li><img src="'+i+'"></li>',n.append(a),e.id});r.val(i.join(","))})}}),e(".wiloke-button-media").on("click",".remove",function(){var t=e(this),a=t.closest(".wiloke-format-block"),i=e(".screenshot",a),o=e(".wiloke-media-value",a);return i.html(""),o.val(""),!1})}e(document).ready(function(){t(),a()})}(jQuery);